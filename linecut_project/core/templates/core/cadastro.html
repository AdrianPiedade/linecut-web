{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LineCut - Cadastro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/css/cadastro.css' %}">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="{% static 'core/images/logo_home.png' %}" alt="LineCut Logo">
        </div>
        <div class="nav-links">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'quem_somos' %}">Quem somos</a>
            <a href="{% url 'planos' %}">Planos</a>
            <a href="{% url 'como_funciona' %}">Como Funciona</a>
        </div>
        <div class="auth-buttons">
            <a href="{% url 'login' %}" class="btn-entrar">Entrar</a>
            <a href="{% url 'cadastro' %}" class="btn-cadastrar">Cadastrar</a>
        </div>
    </nav>

    <div class="red-background"></div>
    
    <main class="cadastro-container">
        <h1>Cadastrar</h1>
        
        <form method="POST" class="cadastro-form" id="cadastroForm" onsubmit="return false;">
            {% csrf_token %}
            
            <div class="form-columns">
                <div class="form-column">
                    <div class="form-group">
                        <label for="cnpj">CNPJ</label>
                        <div class="input-wrapper">
                            <input type="text" id="cnpj" name="cnpj" placeholder="00.000.000/0000-00" required>
                            <div id="cnpj-loading" class="loading-spinner" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="nome_fantasia">Nome fantasia</label>
                        <input type="text" id="nome_fantasia" name="nome_fantasia" placeholder="Será preenchido automaticamente" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="razao_social">Razão social</label>
                        <input type="text" id="razao_social" name="razao_social" placeholder="Será preenchido automaticamente" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="telefone">Telefone</label>
                        <input type="text" id="telefone" name="telefone" placeholder="(00) 00000-0000" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" placeholder="seu@email.com.br" required>
                    </div>
                </div>
                
                <div class="form-column">
                    <div class="plano-selecionado">
                        <h3>Plano selecionado</h3>
                        <div class="custom-select">
                            <select id="plano" name="plano">
                                <option value="trial" selected>Trial</option>
                                <option value="basic">Basic</option>
                                <option value="premium">Premium</option>
                            </select>
                            <div class="select-icon">
                                <i class="bi bi-crown"></i>
                                <i class="bi bi-chevron-down arrow"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group-duo">
                        <div class="form-group">
                            <label for="cep">CEP</label>
                            <div class="input-wrapper">
                                <input type="text" id="cep" name="cep" placeholder="00000-000" required>
                                <div id="cep-loading" class="loading-spinner" style="display: none;"></div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="numero">Número</label>
                            <input type="text" id="numero" name="numero" placeholder="1234" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="endereco">Endereço</label>
                        <input type="text" id="endereco" name="endereco" placeholder="O endereço será preenchido automaticamente" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="polo">Polo</label>
                        <div class="custom-select">
                            <select id="polo" name="polo" required>
                                <option value="" disabled selected>Selecione um polo</option>
                                {% if polos %}
                                    {% for chave, nome in polos %}
                                        <option value="{{ chave }}">{{ nome }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="" disabled>Erro ao carregar polos</option>
                                {% endif %}
                            </select>
                            <div class="select-icon">
                                <i class="bi bi-chevron-down"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group password-group">
                        <label for="senha">Senha</label>
                        <div class="password-input-container">
                            <input type="password" id="senha" name="senha" placeholder="Digite sua senha" required>
                            <button type="button" id="toggleSenha" class="toggle-password">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        
                        <div id="senha-validacao" class="senha-validacao" style="display: none;">
                            <p class="senha-titulo">A senha deve conter:</p>
                            <ul class="senha-requisitos">
                                <li id="req-tamanho" class="requisito">
                                    <i class="bi bi-x-circle"></i>
                                    <span>Pelo menos 10 caracteres</span>
                                </li>
                                <li id="req-maiuscula-minuscula" class="requisito">
                                    <i class="bi bi-x-circle"></i>
                                    <span>Letras maiúsculas e minúsculas</span>
                                </li>
                                <li id="req-numero" class="requisito">
                                    <i class="bi bi-x-circle"></i>
                                    <span>Pelo menos 1 número</span>
                                </li>
                                <li id="req-especial" class="requisito">
                                    <i class="bi bi-x-circle"></i>
                                    <span>Pelo menos 1 caractere especial</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="termos-container">
                <div class="termo-check">
                    <input type="checkbox" id="termos_condicoes" name="termos_condicoes" required disabled>
                    <label for="termos_condicoes">
                        Li e concordo com os <a href="#" class="link-termo" id="link-termos">Termos e Condições</a>
                    </label>
                </div>
                
                <div class="termo-check">
                    <input type="checkbox" id="politica_privacidade" name="politica_privacidade" required disabled>
                    <label for="politica_privacidade">
                        Aceito a <a href="#" class="link-termo" id="link-politica">Política de Privacidade</a>
                    </label>
                </div>
                
                <p class="termo-instruction" id="termo-instruction">
                    <i class="bi bi-info-circle"></i>
                    Por favor, leia e role até o final de cada documento para aceitar
                </p>
            </div>
            
            <button type="submit" class="btn-cadastrar-form" id="btn-cadastrar" >Cadastrar</button>
        </form>
    </main>

    <div id="modal-termos" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Termos e Condições</h2>
                <button class="modal-close" data-modal="termos">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="termos-content">
                {% with texto=termos_condicoes %} {# Usa a variável do contexto #}
                    {% if texto and texto.secoes %}
                        <h3>{{ texto.titulo|default:"Termos e Condições" }}</h3>
                        {% if texto.ultima_atualizacao %}
                            <p>Última atualização: [{{ texto.ultima_atualizacao }}]</p>
                        {% endif %}

                        {% for secao in texto.secoes %}
                            {% if secao.cabecalho %}
                                <h4>{{ secao.cabecalho }}</h4>
                            {% endif %}
                            {% if secao.paragrafos %}
                                {% for paragrafo in secao.paragrafos %}
                                    <p {% if secao.e_rodape %}class="modal-end"{% endif %}>
                                        {{ paragrafo|safe }}
                                    </p>
                                {% endfor %}
                            {% endif %}
                            {% if secao.itens_lista %}
                                <ul>
                                    {% for item in secao.itens_lista %}
                                        <li>{{ item|safe }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <h3>Erro</h3>
                        <p>Não foi possível carregar os Termos e Condições no momento.</p>
                    {% endif %}
                {% endwith %}
            </div>
            <div class="modal-footer">
                <div class="scroll-indicator" id="indicator-termos">
                    <i class="bi bi-arrow-down"></i>
                    <span>Role até o final para aceitar</span>
                </div>
                <button class="btn-concordar" id="btn-concordar-termos" disabled>Concordar e continuar</button>
            </div>
        </div>
    </div>

    <div id="modal-politica" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Política de Privacidade</h2>
                <button class="modal-close" data-modal="politica">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="modal-body" id="politica-content">
                {% with texto=politica_privacidade %} {# Usa a variável do contexto #}
                    {% if texto and texto.secoes %}
                        <h3>{{ texto.titulo|default:"Política de Privacidade" }}</h3>
                        {% if texto.ultima_atualizacao %}
                            <p>Última atualização: [{{ texto.ultima_atualizacao }}]</p>
                        {% endif %}

                        {% for secao in texto.secoes %}
                            {% if secao.cabecalho %}
                                <h4>{{ secao.cabecalho }}</h4>
                            {% endif %}
                            {% if secao.paragrafos %}
                                {% for paragrafo in secao.paragrafos %}
                                    <p {% if secao.e_rodape %}class="modal-end"{% endif %}>
                                        {{ paragrafo|safe }}
                                    </p>
                                {% endfor %}
                            {% endif %}
                            {% if secao.itens_lista %}
                                <ul>
                                    {% for item in secao.itens_lista %}
                                        <li>{{ item|safe }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <h3>Erro</h3>
                        <p>Não foi possível carregar a Política de Privacidade no momento.</p>
                    {% endif %}
                {% endwith %}
            </div>
            <div class="modal-footer">
                <div class="scroll-indicator" id="indicator-politica">
                    <i class="bi bi-arrow-down"></i>
                    <span>Role até o final para aceitar</span>
                </div>
                <button class="btn-concordar" id="btn-concordar-politica" disabled>Concordar e continuar</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-logo">
            <img src="{% static 'core/images/logo_home.png' %}" alt="LineCut Logo">
        </div>
        <div class="footer-links">
            <div class="sobre">
                <h3>Sobre</h3>
                <a href="{% url 'quem_somos' %}">Quem somos</a>
                <a href="{% url 'como_funciona' %}">Como Funciona</a>
            </div>
            <div class="descubra">
                <h3>Descubra</h3>
                <a href="{% url 'cadastro' %}">Cadastre seu restaurante</a>
                <a href="{% url 'login' %}">Seja parceiro</a>
                <a href="{% url 'planos' %}">Planos</a>
            </div>
        </div>
        <div class="footer-copyright">
            <p>© 2025 LineCut. Todos os direitos reservados.</p>
        </div>
    </footer>

    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center;">
        <div style="text-align: center;">
            <div class="spinner-border text-danger" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Processando cadastro...</p>
        </div>
    </div>

    <div id="error-message" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 10000;" class="alert alert-danger"></div>

    <script src="{% static 'core/js/mascaras.js' %}"></script>
    <script src="{% static 'core/js/notificacoes.js' %}"></script>
    <script src="{% static 'core/js/cep.js' %}"></script>
    <script src="{% static 'core/js/cnpj.js' %}"></script>
    <script src="{% static 'core/js/senha.js' %}"></script>
    <script src="{% static 'core/js/termos.js' %}"></script>
    <script src="{% static 'core/js/plano.js' %}"></script>
    <script src="{% static 'core/js/cadastro_submit.js' %}"></script>
    
</body>
</html>
