{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}LineCut - Pedidos{% endblock %}

{% block head_extra %}
    <link rel="stylesheet" href="{% static 'dashboard/css/pedidos.css' %}">
{% endblock %}

{% block content %}
    <header class="cabecalho-pedidos">
        <nav class="tabs-pedidos">
            <button class="tab-link active" data-tab="preparo">Preparo</button>
            <button class="tab-link" data-tab="retirada">Retirada</button>
            <button class="tab-link" data-tab="historico">Histórico de Pedidos</button>
        </nav>
    </header>

    <div class="filtros">
        <div class="filtro-item filtro-busca">
             <input type="text" id="search-input" placeholder="Buscar por ID do Pedido (#)">
        </div>
         <div class="filtro-item filtro-ordenar">
            <label for="sort-order">Ordenar por</label>
            <select id="sort-order">
                <option value="desc" selected>Mais recentes</option>
                <option value="asc">Mais antigos</option>
            </select>
        </div>
        <button class="btn-filtrar" id="apply-filters-btn"><i class="bi bi-funnel-fill"></i> Aplicar Filtros</button>
    </div>

    <div id="loading-indicator" class="loading-indicator" style="display: none;">
        <div class="spinner"></div> Carregando pedidos...
    </div>

    <div id="tab-content">
        <div id="preparo-content" class="tab-pane active">
            <div class="tabela-pedidos">
                <div class="cabecalho-tabela">
                    <span class="col-status">Status</span>
                    <span class="col-numero">Id Pedido</span>
                    <span class="col-pagamento-status">Pgto Status</span>
                    <span class="col-metodo-pagamento">Método Pgto</span>
                    <span class="col-valor">Valor</span>
                    <span class="col-data">Data</span>
                    <span class="col-acoes">Ações</span>
                </div>
                <div class="corpo-tabela" id="preparo-table-body">
                    <div class="linha-vazia">Nenhum pedido em preparo no momento.</div>
                </div>
            </div>
        </div>

        <div id="retirada-content" class="tab-pane">
             <div class="tabela-pedidos">
                <div class="cabecalho-tabela">
                    <span class="col-status">Status</span>
                    <span class="col-numero">Id Pedido</span>
                    <span class="col-pagamento-status">Pgto Status</span>
                    <span class="col-metodo-pagamento">Método Pgto</span>
                    <span class="col-valor">Valor</span>
                    <span class="col-acoes">Ações</span>
                </div>
                <div class="corpo-tabela" id="retirada-table-body">
                    <div class="linha-vazia">Nenhum pedido pronto para retirada.</div>
                </div>
            </div>
        </div>

        <div id="historico-content" class="tab-pane">
             <div class="tabela-pedidos">
                <div class="cabecalho-tabela">
                    <span class="col-status">Status</span>
                    <span class="col-numero">Id Pedido</span>
                    <span class="col-metodo-pagamento">Método Pgto</span>
                    <span class="col-valor">Valor</span>
                    <span class="col-data">Data</span>
                    <span class="col-acoes">Ações</span>
                </div>
                <div class="corpo-tabela" id="historico-table-body">
                    <div class="linha-vazia">Nenhum pedido no histórico.</div>
                </div>
            </div>
        </div>
    </div>

    <template id="pedido-row-template">
        <div class="linha-pedido">
            <div class="col-status">
                <div class="status-wrapper">
                    <span class="status-dot"></span>
                    <span class="status-text"></span>
                </div>
                <span class="hora"></span>
            </div>
            <div class="col-numero">
                <span class="numero-id"></span>
            </div>
            <div class="col-pagamento-status" style="display:none;">
                <div class="pagamento-wrapper">
                    <span class="pagamento-dot"></span>
                    <span class="pagamento-text-principal"></span>
                </div>
            </div>
             <div class="col-metodo-pagamento">
                <span class="metodo-texto"></span>
            </div>
            <div class="col-valor"></div>
            <div class="col-data" style="display:block;"></div>
            <div class="col-acoes"></div>
        </div>
    </template>

    <div id="modal-detalhes-pedido" class="modal">
        <div class="modal-conteudo modal-detalhes">
            <div class="modal-cabecalho">
                <h2 id="detalhes-titulo">Pedido Nº #</h2>
                <span class="fechar-modal" onclick="closeModal('modal-detalhes-pedido')">&times;</span>
            </div>
            <div class="modal-corpo">
                <div class="detalhes-header">
                     <span id="detalhes-pagamento-info"></span>
                     <span id="detalhes-pagamento-status" class="pagamento-status"><i class="bi"></i></span>
                 </div>
                <div class="detalhes-status-historico">
                    <h4>Histórico do Pedido</h4>
                    <ul id="detalhes-status-lista"><li>Carregando...</li></ul>
                </div>
                <div class="detalhes-itens">
                    <h4>Itens do Pedido</h4>
                    <table id="detalhes-itens-tabela">
                        <thead><tr><th>Qtd.</th><th>Item</th><th>Valor Unit.</th><th>Subtotal</th></tr></thead>
                        <tbody><tr><td colspan="4">Carregando...</td></tr></tbody>
                        <tfoot><tr><td colspan="3" class="total-label">Total</td><td class="total-valor" id="detalhes-total">R$ --,--</td></tr></tfoot>
                    </table>
                </div>
            </div>
            <div class="modal-rodape modal-rodape-detalhes">
                <div id="detalhes-acoes-pedido">
                </div>
            </div>
        </div>
    </div>

    <div id="modal-confirmacao-cancelamento" class="modal">
         <div class="modal-conteudo modal-confirmacao">
             <div class="modal-cabecalho">
                 <h2>Confirmar Cancelamento</h2>
                 <span class="fechar-modal" onclick="closeModal('modal-confirmacao-cancelamento')">&times;</span>
             </div>
             <div class="modal-corpo">
                <p>Você tem certeza que deseja cancelar este pedido?</p>
                 <label for="motivo-cancelamento">Para continuar com o cancelamento, informe o motivo:</label>
                <textarea id="motivo-cancelamento" rows="3" placeholder="Digite o motivo do cancelamento..."></textarea>
                <p class="confirmacao-subtexto">O cancelamento do pedido não poderá ser revertido.</p>
             </div>
             <div class="modal-rodape">
                <button class="btn-modal btn-neutro" onclick="closeModal('modal-confirmacao-cancelamento')">Voltar</button>
                <button class="btn-modal btn-cancelar" id="btn-confirma-cancelamento">Cancelar Pedido</button>
             </div>
        </div>
    </div>

    <div id="modal-confirmacao-status" class="modal">
         <div class="modal-conteudo modal-confirmacao">
             <div class="modal-cabecalho">
                 <h2 id="confirmacao-status-titulo">Confirmar Ação</h2>
                 <span class="fechar-modal" onclick="closeModal('modal-confirmacao-status')">&times;</span>
             </div>
             <div class="modal-corpo">
                <p id="confirmacao-status-mensagem">Tem certeza?</p>
                <p id="confirmacao-status-subtexto" class="confirmacao-subtexto" style="display: none;"></p>
             </div>
             <div class="modal-rodape">
                <button class="btn-modal btn-neutro" onclick="closeModal('modal-confirmacao-status')">Voltar</button>
                <button class="btn-modal btn-confirmar" id="btn-confirma-status-modal">Confirmar</button>
             </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'dashboard/js/pedidos.js' %}"></script>
{% endblock %}