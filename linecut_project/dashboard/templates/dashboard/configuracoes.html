{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}LineCut - Configura√ß√µes{% endblock %}

{% block head_extra %}
    <link rel="stylesheet" href="{% static 'dashboard/css/configuracoes.css' %}">
{% endblock %}

{% block content %}
    <header class="cabecalho-configuracoes">
        <div class="titulos">
            <h1 class="titulo-ativo" id="titulo-perfil">Perfil</h1>
            <h1 class="titulo-inativo" id="titulo-ajuda">Ajuda</h1>
        </div>
    </header>

    <div id="secao-perfil" class="secao-configuracoes">
        <div class="card-configuracao">
            <div class="card-header"><h2>Perfil da Lanchonete</h2></div>
            <div class="card-body">
                <div class="perfil-info">
                    <div class="perfil-imagem" id="perfil-imagem" onclick="document.getElementById('company-image-input').click()">
                        <img id="logo-lanchonete"
                             src="{{ company_data.image_url|default_if_none:''|default:'/static/dashboard/images/perfil_default.png' }}"
                             alt="Logo Lanchonete">
                        <div class="perfil-imagem-overlay"><span class="perfil-imagem-texto">Alterar</span></div>
                    </div>
                    <input type="file" id="company-image-input" name="company_image" accept="image/*" style="display: none;" onchange="handleCompanyImageUpload(this.files[0])">
                    <div class="perfil-detalhes">
                        <h3 id="nome-lanchonete">{{ company_data.nome_lanchonete|default:"Nome Lanchonete" }}</h3>
                        <p id="categoria-lanchonete">{{ company_data.description|default:"Descri√ß√£o" }}</p>
                        <div class="plano-info">
                            <div class="plano-badge" id="plano-badge">
                                <span class="icone-plano">
                                    {% with plano=company_data.plano|default:"premium" %}
                                        {% if plano == 'trial' %}üß©
                                        {% elif plano == 'basic' %}üíº
                                        {% else %}üëë
                                        {% endif %}
                                    {% endwith %}
                                </span>
                                <span id="tipo-plano">{{ company_data.plano|default:"premium"|capfirst }}</span>
                            </div>
                            <a href="#" class="link-mudar-plano" onclick="abrirModalPlanos()">Mudar plano</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-configuracao">
            <div class="card-header">
                <h2>Hor√°rio de Funcionamento</h2>
                <button class="btn-editar-card" onclick="editarHorario()">
                    <img src="{% static 'dashboard/images/icone_edicao.png' %}" alt="Editar">
                </button>
            </div>
            <div class="card-body" id="horario-display-body">
               <div id="horario-info-container"><p>Carregando hor√°rios...</p></div>
            </div>
        </div>

        <div class="card-configuracao">
            <div class="card-header">
                <h2>Informa√ß√µes da Conta</h2>
                <button class="btn-editar-card" onclick="editarInformacoes()">
                    <img src="{% static 'dashboard/images/icone_edicao.png' %}" alt="Editar">
                </button>
            </div>
            <div class="card-body">
                <div class="tabela-informacoes">
                    <div class="linha-informacao"><div class="coluna-titulo">Nome Fantasia</div><div class="coluna-valor" id="info-nome-fantasia">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Raz√£o Social</div><div class="coluna-valor" id="info-razao-social">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">CNPJ</div><div class="coluna-valor" id="info-cnpj">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Nome Lanchonete</div><div class="coluna-valor" id="info-nome-lanchonete">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Descri√ß√£o</div><div class="coluna-valor" id="info-description">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Polo</div><div class="coluna-valor" id="info-polo">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Telefone</div><div class="coluna-valor" id="info-telefone">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Endere√ßo</div><div class="coluna-valor" id="info-endereco">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">N√∫mero</div><div class="coluna-valor" id="info-numero">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">CEP</div><div class="coluna-valor" id="info-cep">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Data Cadastro</div><div class="coluna-valor" id="info-data-cadastro">...</div></div>
                    <div class="linha-informacao"><div class="coluna-titulo">Chave PIX</div><div class="coluna-valor" id="info-chave-pix">...</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="secao-ajuda" class="secao-configuracoes" style="display: none;">
        <div class="ajuda-cards-container">
            <div class="ajuda-card" data-modal="modal-faq">
                 <div class="ajuda-card-header"><div class="ajuda-card-icon"><img src="{% static 'dashboard/images/icone_faq.png' %}" alt="FAQ"></div><div class="ajuda-card-titles"><h3>FAQ</h3><p>Perguntas Frequentes</p></div></div>
                <div class="ajuda-card-descricao"><p>Encontre respostas r√°pidas para as d√∫vidas mais comuns.</p></div>
            </div>
             <div class="ajuda-card" data-modal="modal-sac">
                 <div class="ajuda-card-header"><div class="ajuda-card-icon"><img src="{% static 'dashboard/images/icone_sac.png' %}" alt="SAC"></div><div class="ajuda-card-titles"><h3>SAC</h3><p>Precisando de Ajuda?</p></div></div>
                <div class="ajuda-card-descricao"><p>N√£o encontrou o que precisava? Fale conosco.</p></div>
            </div>
            <div class="ajuda-card" data-modal="modal-contato">
                 <div class="ajuda-card-header"><div class="ajuda-card-icon"><img src="{% static 'dashboard/images/icone_email.png' %}" alt="Contato"></div><div class="ajuda-card-titles"><h3>CONTATO</h3><p>Fale Conosco</p></div></div>
                <div class="ajuda-card-descricao"><p>Entre em contato com nossa equipe de suporte.</p></div>
            </div>
            <div class="ajuda-card" data-modal="modal-termos">
                 <div class="ajuda-card-header"><div class="ajuda-card-icon"><img src="{% static 'dashboard/images/icone_info.png' %}" alt="Termos"></div><div class="ajuda-card-titles"><h3>Termos e Condi√ß√µes</h3><p>Regras de Utiliza√ß√£o</p></div></div>
                <div class="ajuda-card-descricao"><p>Leia os termos que regem o uso da plataforma.</p></div>
            </div>
             <div class="ajuda-card" data-modal="modal-politica">
                 <div class="ajuda-card-header"><div class="ajuda-card-icon"><img src="{% static 'dashboard/images/icone_info.png' %}" alt="Pol√≠tica"></div><div class="ajuda-card-titles"><h3>Pol√≠tica de Privacidade</h3><p>Seus Dados Seguros</p></div></div>
                <div class="ajuda-card-descricao"><p>Entenda como protegemos os dados.</p></div>
            </div>
        </div>
    </div>

    <div id="modal-planos" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho">
                <h2>Mudar Plano de Assinatura</h2>
                <span class="fechar-modal" onclick="fecharModalPlanos()">&times;</span>
            </div>
            <div class="modal-corpo">
                <div id="plano-bloqueado-alert" style="display: none; background: #fff3f3; border: 1px solid var(--vermelho); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: var(--vermelho); margin: 0; font-size: 14px;">
                        ‚ö†Ô∏è <strong>Seu per√≠odo trial expirou.</strong> Escolha Basic ou Premium.
                    </p>
                </div>
                <div class="planos-container">
                     <div class="plano-option" data-plano="trial">
                        <h3>Trial</h3> <p class="plano-preco">Gr√°tis</p> <p class="plano-taxa">30 dias</p>
                        <ul><li>‚úÖ Gest√£o completa</li><li>‚úÖ Feedback</li><li>‚úÖ Venda app</li><li>‚úÖ Essenciais</li><li>‚è∞ 30 dias</li></ul>
                    </div>
                     <div class="plano-option" data-plano="basic">
                        <h3>Basic</h3> <p class="plano-preco">S/ Mensalidade</p> <p class="plano-taxa">7% / venda</p>
                        <ul><li>‚úÖ Gest√£o completa</li><li>‚úÖ Feedback</li><li>‚úÖ Venda app</li><li>‚úÖ Essenciais</li><li>üöÄ Ilimitado</li></ul>
                        <div class="plano-recomendado">Popular</div>
                    </div>
                     <div class="plano-option" data-plano="premium">
                        <h3>Premium</h3> <p class="plano-preco">S/ Mensalidade</p> <p class="plano-taxa">10% / venda</p>
                        <ul><li>‚úÖ Recursos Basic</li><li>üìä Dashboard</li><li>üìà Relat√≥rios</li><li>üéØ Insights</li><li>üöÄ Ilimitado</li></ul>
                        <div class="plano-recomendado">Completo</div>
                    </div>
                </div>
                <div class="plano-atual">
                    <p>Plano atual: <strong id="plano-atual-nome">...</strong></p>
                    <p class="plano-info-adicional">* Taxa sobre valor total da venda.</p>
                </div>
            </div>
            <div class="modal-rodape">
                <button type="button" class="btn-cancelar" onclick="fecharModalPlanos()">Cancelar</button>
                <button type="button" class="btn-salvar" onclick="confirmarMudancaPlano()">Confirmar Mudan√ßa</button>
            </div>
        </div>
    </div>

    <div id="modal-perfil" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho">
                <h2>Editar Perfil da Lanchonete</h2>
                <span class="fechar-modal" onclick="fecharModalPerfil()">&times;</span>
            </div>
            <form id="form-perfil">
                 {% csrf_token %}
                <div class="modal-corpo">
                    <div class="form-group">
                        <label for="edit-nome-lanchonete">Nome da Lanchonete *</label>
                        <input type="text" id="edit-nome-lanchonete" name="nome_lanchonete" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-description">Descri√ß√£o da Lanchonete *</label>
                        <input type="text" id="edit-description" name="description" required placeholder="Ex: Lanches e Salgados">
                    </div>
                    <div class="form-group">
                        <label for="edit-telefone">Telefone *</label>
                        <input type="text" id="edit-telefone" name="telefone" required placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label for="edit-chave-pix">Chave PIX</label>
                        <input type="text" id="edit-chave-pix" name="chave_pix" placeholder="Sua chave PIX (opcional)">
                    </div>
                </div>
                <div class="modal-rodape">
                    <button type="button" class="btn-cancelar" onclick="fecharModalPerfil()">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-horario" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho">
                <h2>Editar Hor√°rio de Funcionamento</h2>
                <span class="fechar-modal" onclick="fecharModalHorario()">&times;</span>
            </div>
            <form id="form-horario" onsubmit="event.preventDefault(); salvarHorario();">
                 {% csrf_token %}
                <div class="modal-corpo">
                    <p>Marque os dias e defina os hor√°rios de abertura e fechamento.</p>
                    <div class="horario-editor-container">
                        {# Loop para gerar os dias - Idealmente dados viriam da view #}
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-segunda" onchange="toggleTimeInputs('segunda')"> Segunda-feira</label><div class="time-inputs" id="time-inputs-segunda" style="display: none;"><input type="time" id="edit-segunda-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-segunda-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-terca" onchange="toggleTimeInputs('terca')"> Ter√ßa-feira</label><div class="time-inputs" id="time-inputs-terca" style="display: none;"><input type="time" id="edit-terca-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-terca-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-quarta" onchange="toggleTimeInputs('quarta')"> Quarta-feira</label><div class="time-inputs" id="time-inputs-quarta" style="display: none;"><input type="time" id="edit-quarta-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-quarta-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-quinta" onchange="toggleTimeInputs('quinta')"> Quinta-feira</label><div class="time-inputs" id="time-inputs-quinta" style="display: none;"><input type="time" id="edit-quinta-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-quinta-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-sexta" onchange="toggleTimeInputs('sexta')"> Sexta-feira</label><div class="time-inputs" id="time-inputs-sexta" style="display: none;"><input type="time" id="edit-sexta-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-sexta-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-sabado" onchange="toggleTimeInputs('sabado')"> S√°bado</label><div class="time-inputs" id="time-inputs-sabado" style="display: none;"><input type="time" id="edit-sabado-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-sabado-fechamento" value="18:00"></div></div>
                        <div class="dia-horario-editor"><label class="dia-label"><input type="checkbox" id="edit-domingo" onchange="toggleTimeInputs('domingo')"> Domingo</label><div class="time-inputs" id="time-inputs-domingo" style="display: none;"><input type="time" id="edit-domingo-abertura" value="09:00"><span>√†s</span><input type="time" id="edit-domingo-fechamento" value="18:00"></div></div>
                    </div>
                </div>
                <div class="modal-rodape">
                    <button type="button" class="btn-cancelar" onclick="fecharModalHorario()">Cancelar</button>
                    <button type="submit" class="btn-salvar">Salvar Altera√ß√µes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-faq" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho"><h2>FAQ</h2><span class="fechar-modal" onclick="closeModal('modal-faq')">&times;</span></div>
            <div class="modal-corpo">
                <div class="faq-conteudo">
                    <h3>Encontre respostas r√°pidas</h3> <p>Confira nossa lista...</p>
                    <div class="faq-lista">
                        <div class="faq-item"><h4>Cadastrar produto?</h4><p>Acesse "Produtos"...</p></div>
                        <div class="faq-item"><h4>Alterar hor√°rio?</h4><p>Em "Configura√ß√µes"...</p></div>
                        <div class="faq-item"><h4>Ver relat√≥rios?</h4><p>Na se√ß√£o "Dashboard"...</p></div>
                        <div class="faq-item"><h4>Alterar senha?</h4><p>Em "Configura√ß√µes"...</p></div>
                    </div>
                    <div class="faq-contato"><p>N√£o achou? <a href="#" onclick="closeModal('modal-faq'); openModal('modal-sac');">Fale conosco</a>.</p></div>
                </div>
            </div>
            <div class="modal-rodape"><button type="button" class="btn-cancelar" onclick="closeModal('modal-faq')">Fechar</button></div>
        </div>
    </div>

    <div id="modal-sac" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho"><h2>SAC</h2><span class="fechar-modal" data-modal-close="modal-sac">&times;</span></div>
            <div class="modal-corpo">
                <div class="sac-conteudo">
                    <h3>Precisando de Ajuda?</h3><p>Estamos aqui para ajudar!</p>
                    <div class="sac-canais">
                        <div class="canal-item"><div class="canal-icon"><img src="{% static 'dashboard/images/icone_email.png' %}" alt="E"></div><div class="canal-info"><h4>E-mail</h4><p>sac@linecut.app.br</p><small>At√© 24h</small></div></div>
                        <div class="canal-item"><div class="canal-icon"><img src="{% static 'dashboard/images/icone_phone.png' %}" alt="T"></div><div class="canal-info"><h4>Telefone</h4><p>(11) 4004-2000</p><small>Seg-Sex 8h-18h</small></div></div>
                        <div class="canal-item"><div class="canal-icon"><img src="{% static 'dashboard/images/icone_msg.png' %}" alt="W"></div><div class="canal-info"><h4>WhatsApp</h4><p>(11) 99999-0000</p><small>R√°pido</small></div></div>
                    </div>
                </div>
            </div>
            <div class="modal-rodape"><button type="button" class="btn-cancelar" data-modal-close="modal-sac">Fechar</button></div>
        </div>
    </div>

    <div id="modal-contato" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho"><h2>Fale Conosco</h2><span class="fechar-modal" data-modal-close="modal-contato">&times;</span></div>
            <div class="modal-corpo">
                <div class="contato-conteudo">
                    <h3>Entre em contato</h3>
                    <div class="contato-info"><div class="contato-detalhes"><h4>Infos</h4><p><strong>E-mail:</strong> sup@linecut.app.br</p><p><strong>Tel:</strong> (11) 3003-4004</p><p><strong>Hor√°rio:</strong> Seg-Sex 8h-18h</p></div></div>
                </div>
            </div>
            <div class="modal-rodape"><button type="button" class="btn-cancelar" data-modal-close="modal-contato">Fechar</button></div>
        </div>
    </div>

    <div id="modal-termos" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho"><h2>Termos</h2><span class="fechar-modal" onclick="closeModal('modal-termos')">&times;</span></div>
            <div class="modal-corpo">
                <h3>TERMO DE USO...</h3><p>Atualiza√ß√£o: [01/05/2025]</p>
                <h4>1. OBJETO</h4> <p>1.1. Regula...</p> <p>1.2. Acesso...</p>
                <h4>2. ACEITA√á√ÉO</h4> <p>2.1. Declara...</p> <p>2.2. Se n√£o...</p>
                <h4>3. CADASTRO</h4> <p>...</p> <h4>4. OBRIGA√á√ïES</h4> <p>...</p>
                <h4>5. LIMITA√á√ÉO</h4> <p>...</p> <h4>6. PRIVACIDADE</h4> <p>...</p>
                <h4>7. MODIFICA√á√ïES</h4> <p>...</p> <h4>8. LEGISLA√á√ÉO</h4> <p>...</p>
            </div>
            <div class="modal-rodape"><button type="button" class="btn-cancelar" onclick="closeModal('modal-termos')">Fechar</button></div>
        </div>
    </div>

    <div id="modal-politica" class="modal">
        <div class="modal-conteudo">
            <div class="modal-cabecalho"><h2>Privacidade</h2><span class="fechar-modal" onclick="closeModal('modal-politica')">&times;</span></div>
            <div class="modal-corpo">
                <h3>POL√çTICA DE PRIVACIDADE</h3>
                <h4>1. COLETA</h4> <p>Coleta...</p> <ul><li>Dados...</li></ul>
                <h4>2. USO</h4> <p>Usados para:</p> <ul><li>Gest√£o...</li></ul>
                <h4>3. COMPART.</h4> <p>...</p> <h4>4. SEGURAN√áA</h4> <p>...</p>
                <h4>5. DIREITOS</h4> <p>...</p> <h4>6. COOKIES</h4> <p>...</p>
                <h4>7. ALTERA√á√ïES</h4> <p>...</p> <h4>8. CONTATO</h4> <p>...</p>
            </div>
            <div class="modal-rodape"><button type="button" class="btn-cancelar" onclick="closeModal('modal-politica')">Fechar</button></div>
        </div>
    </div>

    <div id="modal-confirmacao" class="modal">
       <div class="modal-conteudo" style="max-width: 500px;">
            <div class="modal-cabecalho">
                <h2 id="confirmacao-titulo-generico">Confirmar A√ß√£o</h2>
                <span class="fechar-modal" onclick="fecharModalConfirmacao()">&times;</span>
            </div>
            <div class="modal-corpo">
                <p id="confirmacao-mensagem">Tem certeza?</p>
                <div id="confirmacao-detalhes" style="display: none;"><p id="confirmacao-detalhes-texto"></p></div>
            </div>
            <div class="modal-rodape">
                <button type="button" class="btn-cancelar" onclick="fecharModalConfirmacao()">Cancelar</button>
                {# --- CORRE√á√ÉO AQUI --- #}
                <button type="button" class="btn-salvar" id="btn-confirmar-mudanca-plano" onclick="confirmarMudancaPlanoModal()">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="modal-editor-imagem-empresa" class="modal">
        <div class="modal-conteudo" style="max-width: 800px;">
            <div class="modal-cabecalho"><h2>Editar Logo</h2><span class="fechar-modal" onclick="fecharEditorImagemEmpresa()">&times;</span></div>
            <div class="editor-imagem-corpo">
                <div class="editor-toolbar">
                    <button type="button" class="btn-editor" onclick="rotateCompanyImage()">‚Üª</button>
                    <button type="button" class="btn-editor" onclick="zoomInCompanyImage()">+</button>
                    <button type="button" class="btn-editor" onclick="zoomOutCompanyImage()">-</button>
                    <button type="button" class="btn-editor" onclick="resetCompanyImageEditor()">‚ü≤</button>
                </div>
                <div class="editor-container"><div class="image-crop-container"><img id="editor-image-empresa" src="" alt="Editar"></div></div>
                <div class="editor-preview"><h4>Preview:</h4><div class="preview-container"><img id="preview-edited-empresa" src="" alt="P"></div></div>
            </div>
            <div class="modal-rodape">
                <button type="button" class="btn-cancelar" onclick="fecharEditorImagemEmpresa()">Cancelar</button>
                <button type="button" class="btn-salvar" onclick="salvarImagemEditadaEmpresa()">Aplicar</button>
            </div>
        </div>
    </div>

    <div id="modal-confirmacao-upload" class="modal">
        <div class="modal-conteudo confirmacao" style="max-width: 500px;">
            <div class="modal-cabecalho"><h2>Confirmar</h2><span class="fechar-modal" onclick="fecharConfirmacaoUpload()">&times;</span></div>
            <div class="modal-corpo">
                <p id="confirmacao-upload-mensagem">Salvar nova imagem?</p>
                <div class="preview-confirmacao"><img id="preview-confirmacao" src="" alt="Nova"></div>
            </div>
            <div class="modal-rodape">
                <button type="button" class="btn-cancelar" onclick="fecharConfirmacaoUpload()">Cancelar</button>
                <button type="button" class="btn-salvar" onclick="confirmarUploadImagem()">Salvar</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    <script src="{% static 'dashboard/js/configuracoes.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', loadInitialData);
    </script>
{% endblock %}